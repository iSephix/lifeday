{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://scholich.ventures/schema/v0.1.json",
  "title": "Lifeday v0.1",
  "type": "object",
  "additionalProperties": false,
  "required": ["date"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Stable UUID for this Lifeday document (producer-generated if available)"
    },
    "date": {
      "type": "string",
      "format": "date",
      "description": "Calendar date in ISO 8601 format YYYY-MM-DD, interpreted in meta.timezone"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Document creation timestamp (producer time)"
    },
    "updated_at": {
      "type": "string",
      "format": "date-time",
      "description": "Document last-updated timestamp (producer time)"
    },
    "checksum": {
      "type": "string",
      "description": "Optional integrity hash of the Lifeday document (e.g. sha256 hex)"
    },
    "dedupe_key": {
      "type": "string",
      "description": "Optional producer-supplied key to help dedupe documents across syncs"
    },
    "provenance": {
      "type": "array",
      "description": "Ordered list of producers/actors that contributed to this Lifeday",
      "items": {
        "$ref": "#/$defs/Provenance"
      }
    },
    "sleep": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/SleepBlock"
      }
    },
    "activity": {
      "$ref": "#/$defs/ActivitySummary"
    },
    "activity_timeseries_refs": {
      "type": "array",
      "description": "Optional references to high-resolution activity traces (CGM/ECG/PPG/GPS, etc.)",
      "items": {
        "$ref": "#/$defs/TimeseriesRef"
      }
    },
    "body": {
      "$ref": "#/$defs/BodySummary"
    },
    "mind": {
      "$ref": "#/$defs/MindSummary"
    },
    "substances": {
      "$ref": "#/$defs/SubstanceSummary"
    },
    "nutrition": {
      "$ref": "#/$defs/NutritionSummary"
    },
    "notes": {
      "type": "string"
    },
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "schema_version": {
          "type": "string",
          "const": "0.1"
        },
        "person_id": {
          "type": "string"
        },
        "timezone": {
          "type": "string",
          "description": "IANA timezone name for interpreting 'date', e.g. 'Europe/Berlin'"
        },
        "validation_level": {
          "type": "string",
          "description": "Producer's validation/assertion level for this document",
          "enum": ["draft", "basic", "strict"]
        },
        "consent": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "consented": {
              "type": "boolean"
            },
            "version": {
              "type": "string"
            },
            "scope": {
              "type": "string",
              "description": "Comma-separated or space-separated scopes, e.g. 'labs wearables'"
            },
            "consented_at": {
              "type": "string",
              "format": "date-time"
            }
          },
          "required": ["consented"]
        }
      },
      "required": ["schema_version"]
    },
    "extensions": {
      "type": "object",
      "description": "Optional extension-specific payloads keyed by extension name",
      "additionalProperties": true
    },
    "timeseries_refs": {
      "type": "array",
      "description": "Optional standardized pointers to large/high-resolution traces stored externally",
      "items": {
        "$ref": "#/$defs/TimeseriesRef"
      }
    }
  },
  "$defs": {
    "MeasuredValue": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "value": {
          "type": ["number", "string", "null"]
        },
        "unit_code": {
          "type": "string",
          "description": "Canonical unit code (recommended: UCUM). Use this to avoid free-text units."
        },
        "source": {
          "type": "string",
          "description": "Device, app, or provider identifier (e.g. 'Oura', 'AppleHealth', 'manual', 'lab:Synlab')"
        },
        "quality": {
          "type": "string",
          "enum": ["measured", "estimated", "self_reported", "missing", "artifact"]
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Producer-estimated confidence in this value, range 0..1"
        },
        "measurement_quality": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "accuracy": {
              "type": "number",
              "description": "Absolute accuracy (e.g. Â± value). Interpretation depends on accuracy_unit_code."
            },
            "accuracy_unit_code": {
              "type": "string",
              "description": "Unit code (recommended UCUM) for the accuracy value if different from unit_code"
            },
            "resolution": {
              "type": "number",
              "description": "Smallest discernible step for the sensor (numeric)"
            },
            "range": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "min": {
                  "type": "number"
                },
                "max": {
                  "type": "number"
                }
              }
            },
            "vendor_grade": {
              "type": "string",
              "description": "Rough class of device, e.g. 'consumer', 'research', 'clinical'"
            },
            "firmware_version": {
              "type": "string",
              "description": "Optional firmware/software version of the measuring device"
            },
            "calibration_at": {
              "type": "string",
              "format": "date-time",
              "description": "Timestamp of last calibration if known"
            }
          }
        },
        "granularity": {
          "type": "string",
          "enum": ["day", "session", "event", "epoch"]
        },
        "captured_at": {
          "type": "string",
          "format": "date-time"
        },
        "raw": {
          "description": "Optional raw payload from the source system",
          "type": ["object", "array", "string", "number", "boolean", "null"]
        }
      },
      "required": ["value"]
    },
    "Provenance": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "actor": {
          "type": "string",
          "description": "Human-readable actor name or system id, e.g. 'Oura', 'ImportScript_v1'"
        },
        "role": {
          "type": "string",
          "description": "Role of the actor, e.g. 'device', 'app', 'importer', 'lab'"
        },
        "imported_at": {
          "type": "string",
          "format": "date-time"
        },
        "description": {
          "type": "string"
        }
      },
      "required": ["actor", "role"]
    },
    "SleepBlock": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Local ID for this sleep block"
        },
        "external_id": {
          "type": "string",
          "description": "Stable ID from upstream system (e.g., Oura sleep ID)"
        },
        "dedupe_key": {
          "type": "string",
          "description": "Optional canonical dedupe key for sleep blocks"
        },
        "start": {
          "type": "string",
          "format": "date-time"
        },
        "end": {
          "type": "string",
          "format": "date-time"
        },
        "duration_min": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "efficiency": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "latency_min": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "rem_min": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "deep_min": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "light_min": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "awakenings": {
          "$ref": "#/$defs/MeasuredValue"
        }
      },
      "required": ["start", "end", "duration_min"]
    },
    "ActivitySummary": {
      "type": "object",
      "additionalProperties": false,
      "minProperties": 1,
      "properties": {
        "steps": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "active_min": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "vigorous_min": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "workouts": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/WorkoutSession"
          }
        }
      }
    },
    "WorkoutSession": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Local ID for this workout session"
        },
        "external_id": {
          "type": "string",
          "description": "Stable ID from upstream system"
        },
        "dedupe_key": {
          "type": "string",
          "description": "Optional canonical dedupe key for workout sessions"
        },
        "start": {
          "type": "string",
          "format": "date-time"
        },
        "end": {
          "type": "string",
          "format": "date-time"
        },
        "label": {
          "type": "string",
          "description": "Free-form description, e.g. 'morning run'"
        },
        "type": {
          "type": "string",
          "description": "Workout category, e.g. 'run', 'strength', 'cycling'"
        },
        "duration_min": {
          "$ref": "#/$defs/MeasuredValue"
        }
      },
      "required": ["start", "end"]
    },
    "BodySummary": {
      "type": "object",
      "additionalProperties": false,
      "minProperties": 1,
      "properties": {
        "weight_kg": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "body_fat_pct": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "resting_hr": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "hrv_rmssd_ms": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "spo2_pct": {
          "$ref": "#/$defs/MeasuredValue"
        }
      }
    },
    "MindSummary": {
      "type": "object",
      "additionalProperties": false,
      "minProperties": 1,
      "properties": {
        "mood_score": {
          "$ref": "#/$defs/MeasuredValue",
          "description": "Recommended: -2..+2 or 1..10 scale; defined by client"
        },
        "stress_score": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "focus_min": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "deep_work_min": {
          "$ref": "#/$defs/MeasuredValue"
        }
      }
    },
    "SubstanceSummary": {
      "type": "object",
      "additionalProperties": false,
      "minProperties": 1,
      "properties": {
        "caffeine_mg": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "alcohol_units": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "nicotine_mg": {
          "$ref": "#/$defs/MeasuredValue"
        }
      }
    },
    "NutritionSummary": {
      "type": "object",
      "additionalProperties": false,
      "minProperties": 1,
      "properties": {
        "calories_kcal": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "protein_g": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "carbs_g": {
          "$ref": "#/$defs/MeasuredValue"
        },
        "fat_g": {
          "$ref": "#/$defs/MeasuredValue"
        }
      }
    },
    "TimeseriesRef": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Local id for the referenced timeseries"
        },
        "kind": {
          "type": "string",
          "description": "Type of trace, e.g. 'cgm', 'ecg', 'ppg', 'gps', 'cgm:glucose'"
        },
        "start": {
          "type": "string",
          "format": "date-time"
        },
        "end": {
          "type": "string",
          "format": "date-time"
        },
        "url_or_blob_ref": {
          "type": "string",
          "description": "Pointer to external storage (signed URL, blob ref, ipfs, etc.)"
        },
        "hash": {
          "type": "string",
          "description": "Optional integrity hash for the referenced blob"
        },
        "resolution_ms": {
          "type": "number",
          "description": "Sampling resolution in milliseconds if applicable"
        }
      },
      "required": ["id", "kind", "start", "end"]
    },
    "LabPanelExtension": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "panels": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "name": {
                "type": "string"
              },
              "provider": {
                "type": "string"
              },
              "taken_at": {
                "type": "string",
                "format": "date-time"
              },
              "markers": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "code": {
                      "type": "string",
                      "description": "Recommended: LOINC code where applicable"
                    },
                    "label": {
                      "type": "string"
                    },
                    "value": {
                      "$ref": "#/$defs/MeasuredValue"
                    },
                    "reference_range": {
                      "type": "object",
                      "additionalProperties": false,
                      "properties": {
                        "low": { "type": "number" },
                        "high": { "type": "number" },
                        "unit_code": { "type": "string" }
                      }
                    }
                  },
                  "required": ["label", "value"]
                }
              }
            }
          }
        }
      }
    }
  }
}
